components:
  - id: "comp:payments"
    name: "Payments API"
    repo: "svc-payments"
    description: "Handles charge/refund flows"
    artifacts:
      - id: "code:payments:service"
        repo: "svc-payments"
        path: "services/payments_service.py"
        depends_on:
          - "code:shared:http_client"
          - "code:auth:client"
          - "code:ledger:client"
      - id: "code:payments:docs-sync"
        repo: "docs-site"
        path: "docs/payments.md"
    endpoints:
      - id: "api:payments:/charge"
        method: "POST"
        path: "/v1/payments/charge"
      - id: "api:payments:/refund"
        method: "POST"
        path: "/v1/payments/refund"
    docs:
      - id: "doc:payments-guide"
        title: "Payments Integration Guide"
        url: "/docs/payments"
      - id: "doc:payments-api"
        title: "Payments API Reference"
        url: "/docs/payments/api"

  - id: "comp:auth"
    name: "Authentication"
    repo: "svc-auth"
    description: "Login + token issuance"
    artifacts:
      - id: "code:auth:client"
        repo: "svc-auth"
        path: "clients/auth_client.py"
      - id: "code:auth:docs"
        repo: "docs-site"
        path: "docs/auth.md"
    endpoints:
      - id: "api:auth:/login"
        method: "POST"
        path: "/v1/auth/login"
    docs:
      - id: "doc:auth-overview"
        title: "Authentication Overview"
        url: "/docs/auth"

  - id: "comp:analytics"
    name: "Analytics Worker"
    repo: "svc-analytics"
    description: "Reporting worker consuming payments/auth APIs"
    artifacts:
      - id: "code:analytics:worker"
        repo: "svc-analytics"
        path: "workers/analytics_worker.py"
        depends_on:
          - "code:payments:service"
          - "code:auth:client"
          - "code:shared:http_client"
    docs:
      - id: "doc:analytics-runbook"
        title: "Analytics Runbook"
        url: "/docs/analytics"

  - id: "comp:mobile"
    name: "Mobile Checkout"
    repo: "mobile-app"
    description: "iOS/Android clients orchestrating auth + payments"
    artifacts:
      - id: "code:mobile:checkout"
        repo: "mobile-app"
        path: "app/modules/checkout.ts"
        depends_on:
          - "code:auth:client"
          - "code:payments:service"
      - id: "code:mobile:docs"
        repo: "docs-site"
        path: "docs/mobile_checkout.md"
    docs:
      - id: "doc:mobile-guide"
        title: "Mobile Checkout Guide"
        url: "/docs/mobile"

  - id: "comp:docs"
    name: "Docs Pipeline"
    repo: "docs-site"
    description: "Static site that renders product documentation"
    artifacts:
      - id: "code:docs:generator"
        repo: "docs-site"
        path: "generator/site_builder.py"
        depends_on:
          - "code:payments:docs-sync"
          - "code:mobile:docs"
      - id: "code:docs:component-map"
        repo: "docs-site"
        path: "generator/component_map.yaml"
    docs:
      - id: "doc:docs-architecture"
        title: "Documentation Architecture"
        url: "/docs/docs-platform"

  - id: "comp:ledger"
    name: "Shared Ledger"
    repo: "shared-ledger"
    description: "Ledger/accounting microservice shared across products"
    artifacts:
      - id: "code:ledger:client"
        repo: "shared-ledger"
        path: "clients/ledger_client.py"
      - id: "code:ledger:docs"
        repo: "docs-site"
        path: "docs/ledger.md"
    endpoints:
      - id: "api:ledger:/entries"
        method: "POST"
        path: "/v1/ledger/entries"
    docs:
      - id: "doc:ledger-reference"
        title: "Ledger Reference"
        url: "/docs/ledger"

dependencies:
  - from_artifact: "code:analytics:worker"
    to_artifact: "code:payments:service"
    reason: "Consumes charge/refund APIs"
  - from_artifact: "code:analytics:worker"
    to_artifact: "code:auth:client"
    reason: "Requests tokens for downstream calls"
  - from_artifact: "code:payments:service"
    to_artifact: "code:ledger:client"
    reason: "Records successful payments in shared ledger"
  - from_artifact: "code:mobile:checkout"
    to_artifact: "code:auth:client"
    reason: "Uses shared auth client"
  - from_artifact: "code:mobile:checkout"
    to_artifact: "code:payments:service"
    reason: "Calls REST endpoints directly"
  - from_artifact: "code:docs:generator"
    to_artifact: "code:payments:docs-sync"
    reason: "Embeds autogenerated snippets from payments repo"
  - from_component: "comp:payments"
    to_component: "comp:auth"
    reason: "Payments service calls auth for token verification"
  - from_component: "comp:mobile"
    to_component: "comp:payments"
    reason: "Mobile checkout triggers Payments APIs"
  - from_component: "comp:mobile"
    to_component: "comp:auth"
    reason: "Mobile login delegates to auth service"
  - from_component: "comp:docs"
    to_component: "comp:payments"
    reason: "Docs pipeline renders payments guides"
