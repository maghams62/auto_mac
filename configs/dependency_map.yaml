components:
  - id: "comp:payments"
    name: "Core API / Payments"
    repo: "core-api"
    description: "Upstream payments contracts and charge/refund flows."
    aliases:
      - "core.payments"
      - "payments"
    artifacts:
      - id: "code:payments:service"
        repo: "core-api"
        path: "services/payments_service.py"
        depends_on:
          - "code:shared:http_client"
          - "code:auth:client"
          - "code:ledger:client"
      - id: "code:payments:core"
        repo: "core-api"
        path: "src/payments.py"
        depends_on:
          - "code:shared:http_client"
          - "code:auth:client"
      - id: "code:payments:docs-sync"
        repo: "docs-portal"
        path: "docs/payments.md"
    endpoints:
      - id: "api:payments:/charge"
        method: "POST"
        path: "/v1/payments/charge"
      - id: "api:payments:/refund"
        method: "POST"
        path: "/v1/payments/refund"
    docs:
      - id: "doc:payments-guide"
        title: "Payments Integration Guide"
        url: "/docs/payments"
        repo: "docs-portal"
        path: "docs/billing_onboarding.md"
        api_ids:
          - "api:payments:/charge"
          - "api:payments:/refund"
      - id: "doc:payments-api"
        title: "Payments API Reference"
        url: "/docs/payments/api"
        repo: "docs-portal"
        path: "docs/api_usage.md"
        api_ids:
          - "api:payments:/charge"
          - "api:payments:/refund"
          - "api:auth:/validate"

  - id: "comp:auth"
    name: "Authentication"
    repo: "service-auth"
    description: "Login + token issuance"
    aliases:
      - "core.webhooks"
      - "auth"
    artifacts:
      - id: "code:auth:client"
        repo: "service-auth"
        path: "clients/auth_client.py"
      - id: "code:auth:docs"
        repo: "docs-site"
        path: "docs/auth.md"
    endpoints:
      - id: "api:auth:/login"
        method: "POST"
        path: "/v1/auth/login"
      - id: "api:auth:/validate"
        method: "POST"
        path: "/v1/auth/validate"
    docs:
      - id: "doc:auth-overview"
        title: "Authentication Overview"
        url: "/docs/auth"
        repo: "service-auth"
        path: "docs/auth.md"
        api_ids:
          - "api:auth:/login"
          - "api:auth:/validate"

  - id: "comp:analytics"
    name: "Analytics Worker"
    repo: "svc-analytics"
    description: "Reporting worker consuming payments/auth APIs"
    aliases:
      - "analytics"
    artifacts:
      - id: "code:analytics:worker"
        repo: "svc-analytics"
        path: "workers/analytics_worker.py"
        depends_on:
          - "code:payments:service"
          - "code:auth:client"
          - "code:shared:http_client"
    docs:
      - id: "doc:analytics-runbook"
        title: "Analytics Runbook"
        url: "/docs/analytics"

  - id: "comp:mobile"
    name: "Billing Service"
    repo: "billing-service"
    description: "Downstream billing/checkout service that consumes the Core API."
    aliases:
      - "billing.checkout"
      - "mobile.checkout"
    artifacts:
      - id: "code:mobile:checkout"
        repo: "billing-service"
        path: "src/checkout.py"
        depends_on:
          - "code:auth:client"
          - "code:payments:service"
      - id: "code:mobile:docs"
        repo: "docs-portal"
        path: "docs/mobile_checkout.md"
    docs:
      - id: "doc:mobile-guide"
        title: "Mobile Checkout Guide"
        url: "/docs/mobile"
        repo: "docs-portal"
        path: "docs/mobile_checkout.md"
        api_ids:
          - "api:payments:/charge"
          - "api:auth:/login"

  - id: "comp:notifications"
    name: "Notification Service"
    repo: "service-notifications"
    description: "Templated emails and push notifications that depend on Auth tokens"
    aliases:
      - "notifications.dispatch"
    artifacts:
      - id: "code:notifications:service"
        repo: "service-notifications"
        path: "src/notifications.py"
        depends_on:
          - "code:auth:client"
      - id: "code:notifications:scheduler"
        repo: "service-notifications"
        path: "src/scheduler.py"
    docs:
      - id: "doc:notifications-playbook"
        title: "Notification Playbook"
        url: "/docs/notifications/playbook"
        repo: "service-notifications"
        path: "docs/notification_playbook.md"
        api_ids:
          - "api:auth:/validate"

  - id: "comp:docs"
    name: "Docs Portal"
    repo: "docs-portal"
    description: "Static docs portal that renders product documentation."
    aliases:
      - "docs.payments"
      - "docs.notifications"
    artifacts:
      - id: "code:docs:generator"
        repo: "docs-portal"
        path: "generator/site_builder.py"
        depends_on:
          - "code:payments:docs-sync"
          - "code:mobile:docs"
      - id: "code:docs:component-map"
        repo: "docs-portal"
        path: "generator/component_map.yaml"
    docs:
      - id: "doc:docs-architecture"
        title: "Documentation Architecture"
        url: "/docs/docs-platform"
        repo: "docs-portal"
        path: "docs/changelog.md"
      - id: "doc:shared-auth-contract"
        title: "Token Contract Reference"
        url: "/docs/contracts/auth"
        repo: "docs-portal"
        path: "docs/payments_api.md"
        api_ids:
          - "api:auth:/validate"

  - id: "comp:core-api"
    name: "Core API Platform"
    repo: "core-api"
    description: "Owns free-tier enforcement knobs and public API quotas."
    aliases:
      - "core-api"
      - "core.api"
    artifacts:
      - id: "code:core-api:plans"
        repo: "core-api"
        path: "config/plans/free_tier.yaml"
      - id: "code:core-api:ratelimiter"
        repo: "core-api"
        path: "src/limits/rate_limiter.py"
    docs:
      - id: "doc:core-api-free-tier"
        title: "Core API Free Tier Config"
        repo: "core-api"
        path: "config/plans/free_tier.yaml"

  - id: "comp:billing-service"
    name: "Billing Service Quotas"
    repo: "billing-service"
    description: "Downstream billing/pricing logic tied to core-api quotas."
    aliases:
      - "billing quotas"
      - "billing-service"
    artifacts:
      - id: "code:billing:plan-config"
        repo: "billing-service"
        path: "src/pricing/plan_config.py"
        depends_on:
          - "code:core-api:plans"
      - id: "code:billing:client"
        repo: "billing-service"
        path: "src/core_api_client.py"
    docs:
      - id: "doc:billing-plan-config"
        title: "Billing Plan Config Reference"
        repo: "billing-service"
        path: "docs/api_usage.md"

  - id: "comp:web-dashboard"
    name: "Web Dashboard Pricing UI"
    repo: "web-dashboard"
    description: "Customer-facing UI that advertises quota limits."
    aliases:
      - "dashboard.pricing"
      - "web-dashboard"
    artifacts:
      - id: "code:web-dashboard:pricing"
        repo: "web-dashboard"
        path: "src/pages/Pricing.tsx"
        depends_on:
          - "code:billing:plan-config"
          - "code:core-api:plans"
    docs:
      - id: "doc:web-dashboard-pricing"
        title: "Dashboard Pricing Page"
        repo: "web-dashboard"
        path: "src/pages/Pricing.tsx"

  - id: "comp:docs-portal"
    name: "Docs Portal / Pricing"
    repo: "docs-portal"
    description: "Public docs that describe plan quotas and API limits."
    aliases:
      - "docs.pricing"
      - "docs-portal.pricing"
    artifacts:
      - id: "code:docs-portal:pricing"
        repo: "docs-portal"
        path: "docs/pricing/free_tier.md"
        depends_on:
          - "code:web-dashboard:pricing"
          - "code:billing:plan-config"
          - "code:core-api:plans"
    docs:
      - id: "doc:docs-portal-free-tier"
        title: "Docs Portal Free Tier Page"
        repo: "docs-portal"
        path: "docs/pricing/free_tier.md"

  - id: "comp:ledger"
    name: "Shared Ledger"
    repo: "shared-ledger"
    description: "Ledger/accounting microservice shared across products"
    aliases:
      - "shared.ledger"
    artifacts:
      - id: "code:ledger:client"
        repo: "shared-ledger"
        path: "clients/ledger_client.py"
      - id: "code:ledger:docs"
        repo: "docs-site"
        path: "docs/ledger.md"
    endpoints:
      - id: "api:ledger:/entries"
        method: "POST"
        path: "/v1/ledger/entries"
    docs:
      - id: "doc:ledger-reference"
        title: "Ledger Reference"
        url: "/docs/ledger"
  - id: "comp:fastapi-core"
    name: "FastAPI Core"
    repo: "fastapi"
    description: "Upstream FastAPI framework modules and canonical guides."
    aliases:
      - "fastapi.core"
      - "fastapi core"
    artifacts:
      - id: "code:fastapi:core"
        repo: "fastapi"
        path: "fastapi"
      - id: "code:fastapi:routing"
        repo: "fastapi"
        path: "fastapi/routing.py"
      - id: "code:fastapi:tests"
        repo: "fastapi"
        path: "tests"
      - id: "code:fastapi:docs"
        repo: "fastapi"
        path: "docs/en/docs"
    docs:
      - id: "doc:fastapi-release-notes"
        title: "FastAPI Release Notes"
        url: "https://fastapi.tiangolo.com/release-notes/"
        repo: "fastapi"
        path: "docs/en/docs/release-notes.md"
      - id: "doc:fastapi-tutorial"
        title: "FastAPI Tutorial"
        url: "https://fastapi.tiangolo.com/tutorial/"
        repo: "fastapi"
        path: "docs/en/docs/tutorial/index.md"
      - id: "doc:fastapi-deployment"
        title: "FastAPI Deployment Guide"
        url: "https://fastapi.tiangolo.com/deployment/"
        repo: "fastapi"
        path: "docs/en/docs/deployment/index.md"
      - id: "doc:fastapi-contributing"
        title: "FastAPI Contributing Guide"
        url: "https://fastapi.tiangolo.com/contributing/"
        repo: "fastapi"
        path: "docs/en/docs/contributing.md"

  - id: "comp:fastapi-examples"
    name: "FastAPI Examples"
    repo: "fastapi"
    description: "docs_src tutorials, advanced usage, and sample applications."
    aliases:
      - "fastapi.examples"
      - "fastapi tutorial"
    artifacts:
      - id: "code:fastapi:docs-src"
        repo: "fastapi"
        path: "docs_src"
        depends_on:
          - "code:fastapi:core"
      - id: "code:fastapi:templates"
        repo: "fastapi"
        path: "templates"
        depends_on:
          - "code:fastapi:core"
    docs:
      - id: "doc:fastapi-advanced"
        title: "FastAPI Advanced User Guide"
        url: "https://fastapi.tiangolo.com/advanced/"
        repo: "fastapi"
        path: "docs/en/docs/advanced/index.md"

  - id: "comp:httpx-core"
    name: "HTTPX Client"
    repo: "httpx"
    description: "Async HTTP client used by Starlette/FastAPI test clients and integrations."
    aliases:
      - "httpx"
      - "encode.httpx"
      - "httpx client"
    artifacts:
      - id: "code:httpx:client"
        repo: "httpx"
        path: "httpx/_client.py"
      - id: "code:httpx:transport"
        repo: "httpx"
        path: "httpx/_transports"
      - id: "code:httpx:docs"
        repo: "httpx"
        path: "docs"
    docs:
      - id: "doc:httpx-quickstart"
        title: "HTTPX Quickstart"
        url: "https://www.python-httpx.org/quickstart/"
        repo: "httpx"
        path: "docs/quickstart.md"
      - id: "doc:httpx-async"
        title: "HTTPX Async Client"
        url: "https://www.python-httpx.org/async/"
        repo: "httpx"
        path: "docs/async.md"

  - id: "comp:starlette-core"
    name: "Starlette Core"
    repo: "starlette"
    description: "ASGI toolkit, router, and middleware stack powering FastAPI."
    aliases:
      - "starlette"
      - "asgi.starlette"
      - "starlette core"
    artifacts:
      - id: "code:starlette:core"
        repo: "starlette"
        path: "starlette"
      - id: "code:starlette:routing"
        repo: "starlette"
        path: "starlette/routing.py"
        depends_on:
          - "code:starlette:core"
      - id: "code:starlette:docs"
        repo: "starlette"
        path: "docs"
    endpoints:
      - id: "api:starlette:/routing"
        method: "GET"
        path: "/routing"
    docs:
      - id: "doc:starlette-guide"
        title: "Starlette Guide"
        url: "https://www.starlette.io/"
        repo: "starlette"
        path: "docs/index.md"
        api_ids:
          - "api:starlette:/routing"
      - id: "doc:starlette-responses"
        title: "Starlette Responses Reference"
        url: "https://www.starlette.io/responses/"
        repo: "starlette"
        path: "docs/responses.md"

dependencies:
  - from_artifact: "code:analytics:worker"
    to_artifact: "code:payments:service"
    reason: "Consumes charge/refund APIs"
  - from_artifact: "code:analytics:worker"
    to_artifact: "code:auth:client"
    reason: "Requests tokens for downstream calls"
  - from_artifact: "code:payments:service"
    to_artifact: "code:ledger:client"
    reason: "Records successful payments in shared ledger"
  - from_artifact: "code:mobile:checkout"
    to_artifact: "code:auth:client"
    reason: "Uses shared auth client"
  - from_artifact: "code:mobile:checkout"
    to_artifact: "code:payments:service"
    reason: "Calls REST endpoints directly"
  - from_artifact: "code:docs:generator"
    to_artifact: "code:payments:docs-sync"
    reason: "Embeds autogenerated snippets from payments repo"
  - from_artifact: "code:fastapi:routing"
    to_artifact: "code:starlette:routing"
    reason: "FastAPI routing re-exports Starlette router primitives"
  - from_artifact: "code:fastapi:docs"
    to_artifact: "code:starlette:docs"
    reason: "FastAPI docs cite upstream Starlette behavior"
  - from_artifact: "code:starlette:routing"
    to_artifact: "code:httpx:client"
    reason: "Starlette test client wraps HTTPX core client"
  - from_artifact: "code:httpx:docs"
    to_artifact: "code:docs:component-map"
    reason: "Docs site references HTTPX usage examples"
  - from_component: "comp:payments"
    to_component: "comp:auth"
    reason: "Payments service calls auth for token verification"
  - from_component: "comp:mobile"
    to_component: "comp:payments"
    reason: "Mobile checkout triggers Payments APIs"
  - from_component: "comp:mobile"
    to_component: "comp:auth"
    reason: "Mobile login delegates to auth service"
  - from_component: "comp:notifications"
    to_component: "comp:auth"
    reason: "Notification service validates tokens before sending"
  - from_component: "comp:docs"
    to_component: "comp:payments"
    reason: "Docs pipeline renders payments guides"
  - from_component: "comp:docs"
    to_component: "comp:auth"
    reason: "Shared contracts publish the canonical auth schema"
  - from_component: "comp:docs"
    to_component: "comp:fastapi-core"
    reason: "Docs site embeds FastAPI release and tutorial content"
  - from_component: "comp:fastapi-examples"
    to_component: "comp:fastapi-core"
    reason: "Examples import and exercise FastAPI core modules"
  - from_component: "comp:fastapi-core"
    to_component: "comp:starlette-core"
    reason: "FastAPI uses Starlette's ASGI router and middleware"
  - from_component: "comp:fastapi-examples"
    to_component: "comp:starlette-core"
    reason: "Examples depend on Starlette request/response helpers"
  - from_component: "comp:docs"
    to_component: "comp:starlette-core"
    reason: "Docs site covers upstream Starlette behavior"
  - from_component: "comp:starlette-core"
    to_component: "comp:httpx-core"
    reason: "Starlette test utilities are implemented on top of HTTPX"
  - from_component: "comp:fastapi-examples"
    to_component: "comp:httpx-core"
    reason: "Example projects use HTTPX test client"
  - from_component: "comp:docs"
    to_component: "comp:httpx-core"
    reason: "Docs site includes HTTPX quickstart guidance"
  - from_component: "comp:billing-service"
    to_component: "comp:core-api"
    reason: "Billing quotas mirror the upstream core-api limits"
  - from_component: "comp:web-dashboard"
    to_component: "comp:billing-service"
    reason: "Dashboard pulls plan data from billing-service APIs"
  - from_component: "comp:web-dashboard"
    to_component: "comp:core-api"
    reason: "UI links to core-api quota definitions"
  - from_component: "comp:docs-portal"
    to_component: "comp:web-dashboard"
    reason: "Docs reference screenshots and copy from the pricing UI"
  - from_component: "comp:docs-portal"
    to_component: "comp:core-api"
    reason: "Docs must stay in sync with core-api enforcement"
