# Cerebro OS API Specification
# This is the human-facing API documentation that should stay in sync with api_server.py
# The Oqoqo self-evolving docs system will detect drift between this spec and the actual code

openapi: "3.0.3"
info:
  title: Cerebro OS API
  description: |
    REST and WebSocket API for Cerebro OS - an intelligent Mac automation assistant.
    This specification documents the public API endpoints available for integration.
  version: "1.0.0"
  contact:
    name: Cerebro OS
    
servers:
  - url: http://localhost:8000
    description: Local development server

tags:
  - name: Health
    description: Health check and status endpoints
  - name: Chat
    description: Chat and conversation endpoints
  - name: Commands
    description: Command listing and execution
  - name: Agents
    description: Agent information and capabilities
  - name: Config
    description: Configuration management
  - name: Spotify
    description: Spotify playback control
  - name: Files
    description: File and document operations

paths:
  /:
    get:
      tags: [Health]
      summary: Root health check
      description: Basic health check endpoint returning service status
      operationId: root
      responses:
        "200":
          description: Service is online
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "online"
                  service:
                    type: string
                    example: "Cerebro OS API"
                  version:
                    type: string
                    example: "1.0.0"

  /health:
    get:
      tags: [Health]
      summary: Health check for Electron launcher
      description: Returns service health status with timestamp
      operationId: healthCheck
      responses:
        "200":
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "ok"
                  service:
                    type: string
                    example: "Cerebro OS API"
                  timestamp:
                    type: string
                    format: date-time

  /api/stats:
    get:
      tags: [Health]
      summary: Get system statistics
      description: Returns indexed document count, available agents, and uptime
      operationId: getStats
      responses:
        "200":
          description: System statistics
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SystemStats"
        "500":
          description: Server error

  /api/chat:
    post:
      tags: [Chat]
      summary: Synchronous chat endpoint
      description: Send a message and receive a response synchronously
      operationId: chat
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChatMessage"
      responses:
        "200":
          description: Chat response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChatResponse"
        "500":
          description: Server error

  /api/agents:
    get:
      tags: [Agents]
      summary: List available agents
      description: Returns all available agents and their capabilities
      operationId: listAgents
      responses:
        "200":
          description: List of agents
          content:
            application/json:
              schema:
                type: object
                properties:
                  agents:
                    type: array
                    items:
                      $ref: "#/components/schemas/AgentInfo"
        "500":
          description: Server error

  /api/commands:
    get:
      tags: [Commands]
      summary: List available commands
      description: Returns all available commands/actions for the launcher
      operationId: listCommands
      responses:
        "200":
          description: List of commands
          content:
            application/json:
              schema:
                type: object
                properties:
                  commands:
                    type: array
                    items:
                      $ref: "#/components/schemas/Command"
        "500":
          description: Server error

  /api/config:
    get:
      tags: [Config]
      summary: Get configuration
      description: Returns current configuration settings
      operationId: getConfig
      responses:
        "200":
          description: Configuration object
          content:
            application/json:
              schema:
                type: object
        "500":
          description: Server error
    put:
      tags: [Config]
      summary: Update configuration
      description: Update configuration settings
      operationId: updateConfig
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        "200":
          description: Configuration updated
        "500":
          description: Server error

  /api/transcribe:
    post:
      tags: [Files]
      summary: Transcribe audio
      description: Transcribe audio file to text using OpenAI Whisper
      operationId: transcribeAudio
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                audio:
                  type: string
                  format: binary
                  description: Audio file to transcribe
      responses:
        "200":
          description: Transcription result
          content:
            application/json:
              schema:
                type: object
                properties:
                  text:
                    type: string
                    description: Transcribed text
        "400":
          description: Invalid request
        "500":
          description: Transcription failed

  /api/spotify/status:
    get:
      tags: [Spotify]
      summary: Get Spotify playback status
      description: Returns current playback state including track info
      operationId: getSpotifyStatus
      responses:
        "200":
          description: Playback status
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SpotifyStatus"
        "401":
          description: Not authenticated with Spotify
        "500":
          description: Server error

  /api/spotify/play:
    post:
      tags: [Spotify]
      summary: Resume playback
      description: Resume Spotify playback
      operationId: spotifyPlay
      responses:
        "200":
          description: Playback resumed
        "401":
          description: Not authenticated
        "500":
          description: Server error

  /api/spotify/pause:
    post:
      tags: [Spotify]
      summary: Pause playback
      description: Pause Spotify playback
      operationId: spotifyPause
      responses:
        "200":
          description: Playback paused
        "401":
          description: Not authenticated
        "500":
          description: Server error

  /api/spotify/next:
    post:
      tags: [Spotify]
      summary: Skip to next track
      description: Skip to the next track in queue
      operationId: spotifyNext
      responses:
        "200":
          description: Skipped to next track
        "401":
          description: Not authenticated
        "500":
          description: Server error

  /api/spotify/previous:
    post:
      tags: [Spotify]
      summary: Go to previous track
      description: Go back to the previous track
      operationId: spotifyPrevious
      responses:
        "200":
          description: Went to previous track
        "401":
          description: Not authenticated
        "500":
          description: Server error

components:
  schemas:
    SystemStats:
      type: object
      properties:
        indexed_documents:
          type: integer
          description: Number of indexed documents
        total_chunks:
          type: integer
          description: Total document chunks
        available_agents:
          type: array
          items:
            type: string
          description: List of available agent names
        uptime:
          type: string
          description: Service uptime status

    ChatMessage:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          description: User message to process
        session_id:
          type: string
          description: Optional session ID for context

    ChatResponse:
      type: object
      properties:
        response:
          type: string
          description: Assistant response
        status:
          type: string
          description: Response status (completed, error, etc.)
        timestamp:
          type: string
          format: date-time
          description: Response timestamp

    AgentInfo:
      type: object
      properties:
        name:
          type: string
          description: Agent name
        description:
          type: string
          description: Agent description
        tools:
          type: array
          items:
            type: string
          description: Available tools

    Command:
      type: object
      properties:
        id:
          type: string
          description: Command identifier
        title:
          type: string
          description: Display title
        description:
          type: string
          description: Command description
        category:
          type: string
          description: Command category
        icon:
          type: string
          description: Emoji icon
        keywords:
          type: array
          items:
            type: string
          description: Search keywords
        handler_type:
          type: string
          description: Handler type (agent, slash_command, etc.)

    SpotifyStatus:
      type: object
      properties:
        is_playing:
          type: boolean
          description: Whether music is currently playing
        item:
          type: object
          properties:
            name:
              type: string
              description: Track name
            artists:
              type: array
              items:
                type: object
                properties:
                  name:
                    type: string
            album:
              type: object
              properties:
                name:
                  type: string
                images:
                  type: array
                  items:
                    type: object
                    properties:
                      url:
                        type: string
            duration_ms:
              type: integer
        progress_ms:
          type: integer
          description: Current playback position in milliseconds
        device:
          type: object
          properties:
            name:
              type: string
            type:
              type: string

