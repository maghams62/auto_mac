{
  "status": "failed",
  "pass_count": 0,
  "fail_count": 1,
  "test_function": "test_context_publish_consume",
  "outcome": "failed",
  "details": {
    "longrepr": "self = <test_session_context.TestContextBus object at 0x1045ee150>\n\n    def test_context_publish_consume(self):\n        \"\"\"Test publishing and consuming context through the bus.\"\"\"\n        bus = ContextBus()\n    \n        context = SessionContext(\n            original_query=\"Test query\",\n            session_id=\"test_123\"\n        )\n    \n        # Publish context\n        payload = bus.publish_context(\n            session_context=context,\n            from_component=\"test_component\",\n            to_component=\"planner\",\n            purpose=ContextPurpose.PLANNER\n        )\n    \n        assert \"context\" in payload\n        assert \"metadata\" in payload\n        assert payload[\"metadata\"][\"schema_version\"] == \"1.1\"\n        assert payload[\"metadata\"][\"purpose\"] == \"planner\"\n    \n        # Consume context\n>       consumed_context = bus.consume_context(payload, \"consumer\")\n\ntests/test_session_context.py:216: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nsrc/memory/context_bus.py:181: in consume_context\n    session_context = self._deserialize_context(serialized_context)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <src.memory.context_bus.ContextBus object at 0x104619b10>\nserialized_data = {'context_objects': {}, 'derived_topic': None, 'original_query': 'Test query', 'purpose': 'general', ...}\n\n    def _deserialize_context(self, serialized_data: Dict[str, Any]) -> \"SessionContext\":\n        \"\"\"\n        Deserialize context data back to SessionContext.\n    \n        Validates required fields and reconstructs the object.\n        \"\"\"\n        # Ensure required fields exist\n        required_fields = [\"original_query\", \"session_id\"]\n        for field in required_fields:\n            if field not in serialized_data:\n                raise ValueError(f\"Missing required field in context: {field}\")\n    \n        # Reconstruct SessionContext\n        # Note: We need to handle the case where some optional fields might be missing\n        # due to filtering during serialization\n>       return SessionContext(\n            original_query=serialized_data[\"original_query\"],\n            session_id=serialized_data[\"session_id\"],\n            context_objects=serialized_data.get(\"context_objects\", {}),\n            salience_ranked_snippets=serialized_data.get(\"salience_ranked_snippets\", []),\n            retrieval_handles=serialized_data.get(\"retrieval_handles\", {}),\n            token_budget_metadata=serialized_data.get(\"token_budget_metadata\", {}),\n            derived_topic=serialized_data.get(\"derived_topic\"),\n            purpose=serialized_data.get(\"purpose\", \"general\")\n        )\nE       NameError: name 'SessionContext' is not defined\n\nsrc/memory/context_bus.py:261: NameError",
    "duration": 0.00024708398268558085
  },
  "timestamp": "2025-11-12T12:49:42.715363",
  "test_name": "session_context"
}